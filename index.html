<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Love Sync Game ðŸ’•</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<style>
body {
  font-family: Arial;
  text-align: center;
  background: linear-gradient(135deg,#ff758c,#ff7eb3);
  color: white;
  padding: 20px;
}

button {
  padding: 15px 30px;
  font-size: 18px;
  border: none;
  border-radius: 12px;
  margin: 10px;
  cursor: pointer;
}

#loveBar {
  width: 80%;
  height: 30px;
  background: white;
  border-radius: 20px;
  margin: 20px auto;
  overflow: hidden;
}

#progress {
  height: 100%;
  width: 0%;
  background: red;
  transition: width 0.3s;
}

#note {
  margin-top: 20px;
  font-size: 18px;
  display: none;
}

#game {
  display:none;
}
</style>
</head>

<body>

<h2>Love Sync Game ðŸ’ž</h2>

<input id="roomInput" placeholder="Enter Room Code">
<button onclick="joinRoom()">Join</button>

<div id="game">
  <h3 id="levelText">Level 1</h3>

  <div id="loveBar">
    <div id="progress"></div>
  </div>

  <button 
    onmousedown="holdStart()" 
    onmouseup="holdEnd()" 
    ontouchstart="holdStart()" 
    ontouchend="holdEnd()">
    Hold To Stay Connected ðŸ’ž
  </button>

  <div id="note"></div>
</div>

<script>

// ðŸ”¥ YOUR FIREBASE CONFIG
var firebaseConfig = {
  apiKey: "AIzaSyDRKxX4m8PPPev4vHhYhh9x5fSSaUmQIzO0",
  authDomain: "game-c4cb2.firebaseapp.com",
  databaseURL: "https://game-c4cb2-default-rtdb.firebaseio.com/",
  projectId: "game-c4cb2",
  storageBucket: "game-c4cb2.firebasestorage.app",
  messagingSenderId: "413339168960",
  appId: "1:413339168960:web:5722729cb4e41ccb2abd25"
};

firebase.initializeApp(firebaseConfig);
var db = firebase.database();

var room = "";
var level = 1;
var holding = false;

var targets = [100, 160, 230, 320, 450];

var loveNotes = [
  "Level 1 ðŸ’– Even small effort together feels magical.",
  "Level 2 ðŸ’• When we hold on, we grow stronger.",
  "Level 3 â¤ï¸ Distance means nothing when hearts sync.",
  "Level 4 ðŸ’ž We are unstoppable when we stay connected.",
  "Final Level ðŸ’ No matter what level life gives usâ€¦ I choose you forever."
];

function joinRoom() {
  room = document.getElementById("roomInput").value;
  if (!room) return;

  document.getElementById("game").style.display = "block";

  var roomRef = db.ref("rooms/" + room);

  roomRef.once("value").then(snapshot => {
    if (!snapshot.exists()) {
      roomRef.set({
        energy: 0,
        level: 1,
        playersHolding: 0
      });
    }
  });

  roomRef.on("value", snapshot => {
    var data = snapshot.val();
    if (!data) return;

    level = data.level;
    var energy = data.energy;

    document.getElementById("levelText").innerText = "Level " + level;

    var percent = (energy / targets[level-1]) * 100;
    document.getElementById("progress").style.width = percent + "%";

    if (energy >= targets[level-1]) {
      showNote(level-1);

      setTimeout(() => {
        roomRef.update({
          energy: 0,
          level: level + 1
        });
      }, 4000);
    }
  });

  startEnergyLoop();
}

function startEnergyLoop() {
  setInterval(() => {
    if (!room) return;

    var roomRef = db.ref("rooms/" + room);

    roomRef.transaction(data => {
      if (!data) return data;

      if (data.playersHolding >= 2) {
        data.energy += 8;
      } else {
        data.energy -= (5 + level);
      }

      if (data.energy < 0) data.energy = 0;

      return data;
    });

  }, 500);
}

function holdStart() {
  if (!room || holding) return;
  holding = true;

  db.ref("rooms/" + room + "/playersHolding")
    .transaction(val => (val || 0) + 1);
}

function holdEnd() {
  if (!room || !holding) return;
  holding = false;

  db.ref("rooms/" + room + "/playersHolding")
    .transaction(val => Math.max((val || 1) - 1, 0));
}

function showNote(index) {
  var note = document.getElementById("note");
  note.innerText = loveNotes[index];
  note.style.display = "block";

  setTimeout(() => {
    note.style.display = "none";
  }, 3500);
}

</script>
</body>
</html>
